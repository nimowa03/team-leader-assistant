import { GoogleGenerativeAI } from '@google/generative-ai';
import { NextResponse } from 'next/server';

export async function POST(request: Request) {
    try {
        const { notes } = await request.json();

        if (!notes) {
            return NextResponse.json(
                { error: 'íšŒì˜ ë‚´ìš©ì´ ì…ë ¥ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.' },
                { status: 400 }
            );
        }

        const apiKey = process.env.GEMINI_API_KEY;
        if (!apiKey) {
            return NextResponse.json(
                { error: 'API í‚¤ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.' },
                { status: 500 }
            );
        }

        const genAI = new GoogleGenerativeAI(apiKey);
        const model = genAI.getGenerativeModel({ model: 'gemini-2.0-flash' });

        const prompt = `
      ë‹¹ì‹ ì€ ì´ ëª¨ì„ì˜ **ëª¨ë”ë ˆì´í„°(ì§„í–‰ì)**ì´ì íŒ€ ë¦¬ë”ì…ë‹ˆë‹¤.
      ë§¤ì£¼ ì§„í–‰ë˜ëŠ” ì¡°ë³„ ëª¨ì„ì˜ ë‚´ìš©ì„ ë°”íƒ•ìœ¼ë¡œ, ì±„ë„ì— ê³µìœ í•  "ê°„ë‹¨í•˜ê³  ëª…í™•í•œ" íšŒì˜ë¡ì„ ì‘ì„±í•´ì•¼ í•©ë‹ˆë‹¤.

      [ì…ë ¥ëœ ë©”ëª¨]
      ${notes}

      [ë‹¹ì‹ ì˜ ì—­í•  ë° ì§€ì¹¨]
      1. **ëª¨ë”ë ˆì´íŒ…(Moderating)**: íšŒì˜ ë‚´ìš©ì„ ë‹¨ìˆœíˆ ë‚˜ì—´í•˜ì§€ ë§ê³ , ì§„í–‰ìê°€ ì •ë¦¬í•˜ë“¯ ê¹”ë”í•˜ê²Œ ìš”ì•½í•´ì£¼ì„¸ìš”.
      2. **ì¶œì„ í™•ì¸(Attendance)**: (ì‹œìŠ¤í…œì´ ìƒë‹¨ì— ì¶œì„ ëª…ë‹¨ì„ ìë™ìœ¼ë¡œ ë¶™ì—¬ì¤ë‹ˆë‹¤.) ë‹¹ì‹ ì€ ë³¸ë¬¸ì—ì„œ "ë°”ì˜ì‹  ì™€ì¤‘ì—ë„ ì°¸ì„í•´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤" ë˜ëŠ” "ë‹¤ìŒ ì£¼ì—ëŠ” ëª¨ë‘ ëµ ìˆ˜ ìˆìœ¼ë©´ ì¢‹ê² ë„¤ìš”"ì™€ ê°™ì´ ì°¸ì—¬ë¥¼ ë…ë ¤í•˜ëŠ” ë”°ëœ»í•œ ë©˜íŠ¸ë¥¼ **ë§ˆë¬´ë¦¬ ì¸ì‚¬**ì— ê¼­ í¬í•¨í•´ì£¼ì„¸ìš”.
      3. **ê°„ê²°í•œ ê³µìœ **: ì´ ê¸€ì€ ì±„íŒ…ë°©ì´ë‚˜ ê²Œì‹œíŒì— ë°”ë¡œ ì˜¬ë¦´ ìš©ë„ì…ë‹ˆë‹¤. ê°€ë…ì„±ì„ ìµœìš°ì„ ìœ¼ë¡œ í•´ì£¼ì„¸ìš”.

      [ì‘ì„± í¬ë§· ê°€ì´ë“œ]
      1. **í†¤ì•¤ë§¤ë„ˆ**: "í•´ìš”ì²´"ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¶€ë“œëŸ½ê³  ì •ì¤‘í•˜ê²Œ ì‘ì„±í•´ì£¼ì„¸ìš”. (ì˜ˆ: "ë…¼ì˜í–ˆìŠµë‹ˆë‹¤" -> "ì´ì•¼ê¸° ë‚˜ëˆ´ì–´ìš”")
      2. **êµ¬ì¡°**:
         - ğŸ“Œ **ì˜¤ëŠ˜ì˜ ì•ˆê±´** (Agenda)
         - ğŸ—£ï¸ **í•¨ê»˜ ë‚˜ëˆˆ ì´ì•¼ê¸°** (Discussion) - í•µì‹¬ ë‚´ìš© ìœ„ì£¼ë¡œ ìš”ì•½
         - âœ¨ **ìš°ë¦¬ë¼ë¦¬ ì •í•œ ì•½ì†** (Decision) - ê²°ì •ëœ ì‚¬í•­ ëª…ê¸°
         - ğŸš€ **ì•ìœ¼ë¡œ í•  ì¼** (Next Steps) - êµ¬ì²´ì ì¸ ì•¡ì…˜ ì•„ì´í…œ
      3. **ë‚´ìš©**: ë‚´ìš©ì´ ì—†ëŠ” ì„¹ì…˜ì€ "íŠ¹ë³„í•œ ë‚´ìš©ì€ ì—†ì—ˆì–´ìš”! ğŸ˜€"ì™€ ê°™ì´ ì„¼ìŠ¤ ìˆê²Œ ì²˜ë¦¬í•´ì£¼ì„¸ìš”.
      4. **í˜•ì‹**: ê° í•­ëª©ì€ ê¸€ë¨¸ë¦¬ ê¸°í˜¸(-)ë¥¼ ì‚¬ìš©í•´ì£¼ì„¸ìš”.
    `;

        const result = await model.generateContent(prompt);
        const response = await result.response;
        const text = response.text();

        return NextResponse.json({ result: text });
    } catch (error) {
        console.error('Gemini API Error:', error);
        return NextResponse.json(
            { error: 'íšŒì˜ë¡ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.' },
            { status: 500 }
        );
    }
}
